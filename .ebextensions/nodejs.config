option_settings:
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: production
    NPM_CONFIG_PRODUCTION: "false"

files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/49_build_application.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      cd /var/app/staging
      echo "=== Starting build process ==="
      echo "Current directory: $(pwd)"
      echo "Node version: $(node --version)"
      echo "NPM version: $(npm --version)"
      
      echo "Installing all dependencies including devDependencies..."
      npm install --include=dev
      
      echo "Running build..."
      npm run build
      
      echo "Verifying build output..."
      if [ -d "dist" ]; then
        echo "✓ dist directory exists"
        ls -la dist/
        if [ -f "dist/index.html" ]; then
          echo "✓ dist/index.html exists"
        else
          echo "✗ dist/index.html does not exist"
          exit 1
        fi
      else
        echo "✗ dist directory does not exist"
        exit 1
      fi
      
      echo "=== Build process completed successfully! ==="
