option_settings:
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: production
    NPM_CONFIG_PRODUCTION: "false"

container_commands:
  01_build:
    command: |
      # Change to app directory
      cd /var/app/staging
      
      # Log environment
      echo "=== Environment Information ==="
      echo "Node version: $(node --version)"
      echo "NPM version: $(npm --version)"
      echo "Current directory: $(pwd)"
      echo "Directory contents:"
      ls -la
      
      # Install dependencies (including dev dependencies for build)
      echo "=== Installing dependencies ==="
      npm ci --include=dev
      
      # Build the application
      echo "=== Building application ==="
      npm run build
      
      # Verify build output
      echo "=== Verifying build output ==="
      if [ -d "dist" ]; then
        echo "✓ dist directory exists"
        echo "dist contents:"
        ls -la dist/
        if [ -f "dist/index.html" ]; then
          echo "✓ dist/index.html exists"
        else
          echo "✗ dist/index.html does not exist"
          exit 1
        fi
      else
        echo "✗ dist directory does not exist"
        exit 1
      fi
      
      echo "=== Build completed successfully ==="
